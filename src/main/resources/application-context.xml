<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:security="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                           http://www.springframework.org/schema/tx
                           http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
                           http://www.springframework.org/schema/context
                           http://www.springframework.org/schema/context/spring-context-2.5.xsd
                           http://www.springframework.org/schema/aop
                           http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
                           http://www.springframework.org/schema/security
                           http://www.springframework.org/schema/security/spring-security-2.0.xsd">

	<context:annotation-config />
	<context:spring-configured />
	<tx:jta-transaction-manager />
	<tx:annotation-driven transaction-manager="transactionManager" />
	
	<bean class="org.springframework.beans.factory.config.PropertyOverrideConfigurer">
		<property name="locations">
			<list>
				<value>${springPropertiesLocation}</value>
			</list>
		</property>
	</bean>
	
	<bean id="notificationTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
		<property name="from" value="a.vincelli@gmail.com"/>
	</bean>
	
	<bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<property name="basename" value="classpath:it/av/youeat/web/YoueatApplication"/>
		<property name="fallbackToSystemLocale" value="true" />
		<property name="cacheSeconds" value="-1"/>
	</bean>

	<bean id="javaMailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl" >
		<property name="host" value="127.0.0.1"/>
	</bean>
	
	<bean id="mailService" class="it.av.youeat.service.system.MailServiceImpl" />
	
	<bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="persistenceUnitName" value="mainPersistance" />
		<property name="persistenceXmlLocation" value="classpath:META-INF/persistence.xml"/>		 
	</bean>
	
	<!-- <bean id="entityManagerFactoryStaticData" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="persistenceUnitName" value="staticDataPersistance" />
		<property name="persistenceXmlLocation" value="classpath:META-INF/persistenceStaticData.xml"></property>
	</bean> -->

	<!--
		PostProcessors to perform resource injection according to the JPA specification
		(@PersistenceContext, @PersistenceUnit).
	-->
	<bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" />

	<!-- turn on @Required annotation checks -->
	<bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"/>

	<!--
		PostProcessors to perform exception translation on @Repository classes (from native
		exceptions such as JPA PersistenceExceptions to Spring's DataAccessException hierarchy).
	-->
	<!-- Transaction manager for a single JPA EntityManagerFactory (alternative to JTA) -->
	<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="entityManagerFactory" />
		<property name="nestedTransactionAllowed" value="false"></property>
	</bean>
	
	<bean id="strongPasswordEncryptor" class="org.jasypt.util.password.StrongPasswordEncryptor" />
	
	<bean id="jpaDaoSupport" class="org.springframework.orm.jpa.support.JpaDaoSupport" abstract="true"/>
	
 	<bean id="wicketApplication" class="it.av.youeat.web.YoueatApplication">
		<property name="configurationType" value="development" />
	</bean>

	<bean id="eaterService" class="it.av.youeat.service.impl.EaterServiceHibernate" parent="jpaDaoSupport" >
		<property name="passwordEncoder" ref="strongPasswordEncryptor" />
	</bean>

	<bean id="commentService" class="it.av.youeat.service.impl.CommentServiceHibernate" parent="jpaDaoSupport" />

	<bean id="eaterProfileService" class="it.av.youeat.service.impl.EaterProfileServiceHibernate" parent="jpaDaoSupport" />

	<bean id="activityService" class="it.av.youeat.service.impl.ActivityServiceHibernate" parent="jpaDaoSupport" />

	<bean id="activityRistoranteService" class="it.av.youeat.service.impl.ActivityRistoranteServiceHibernate" parent="jpaDaoSupport"/>

	<bean id="tagService" class="it.av.youeat.service.impl.TagServiceHibernate" parent="jpaDaoSupport" />

	<bean id="ristoranteRevisionService" class="it.av.youeat.service.impl.RistoranteRevisionServiceHibernate"/>
	
	<bean id="rateRistoranteService" class="it.av.youeat.service.impl.RateRistoranteServiceHibernate"/>
	
	<bean id="ristoranteService" class="it.av.youeat.service.impl.RistoranteServiceHibernate" parent="jpaDaoSupport"/>
	
	
	<!--<bean id="jcrRistoranteService" class="it.av.youeat.service.impl.JcrRistoranteServiceJackrabbit">
		<property name="jcrMappingtemplate" ref="jcrMappingTemplateGeneric" />
		<property name="basePath" value="/ristoranti" />
	</bean>-->
	
	<bean id="eaterRelationService" class="it.av.youeat.service.impl.EaterRelationServiceHibernate" parent="jpaDaoSupport" />
	
	<bean id="activityRelationService" class="it.av.youeat.service.impl.ActivityRelationServiceHibernate" parent="jpaDaoSupport" />
	
	<bean id="dataRistoranteService" class="it.av.youeat.service.impl.DataRistoranteServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="countryRegionService" class="it.av.youeat.service.impl.CountryRegionServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="countryService" class="it.av.youeat.service.impl.CountryServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="cityService" class="it.av.youeat.service.impl.CityServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="languageService" class="it.av.youeat.service.impl.LanguageServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="messageService" class="it.av.youeat.service.impl.MessageServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="dialogService" class="it.av.youeat.service.impl.DialogServiceHibernate" parent="jpaDaoSupport"/>
	
	<bean id="ristorantePictureHibernate" class="it.av.youeat.service.impl.RistorantePictureHibernate" parent="jpaDaoSupport"/>

	<bean id="repositoryInitStructure" class="it.av.youeat.repo.util.RepositoryInitStructureImpl"/>

	<bean id="applicationInit" class="it.av.youeat.init.ApplicationInit">
		<constructor-arg ref="repositoryInitStructure" />
	</bean>

	<bean id="passwordEncoder" class="org.jasypt.spring.security2.PasswordEncoder">
		<property name="passwordEncryptor" ref="strongPasswordEncryptor" />
	</bean>

	<bean id="userDetailsService" class="it.av.youeat.web.security.UserDetailsServiceImpl" scope="prototype">
		<property name="service" ref="eaterService" />
	</bean>

	<bean id="daoAuthenticationProvider" class="org.springframework.security.providers.dao.DaoAuthenticationProvider">
		<property name="userDetailsService" ref="userDetailsService" />
		<property name="passwordEncoder" ref="passwordEncoder" />
	</bean>

	<bean id="authenticationProvider" class="it.av.youeat.web.security.AuthenticationProvider">
		<constructor-arg ref="daoAuthenticationProvider" />
	</bean>
</beans>
